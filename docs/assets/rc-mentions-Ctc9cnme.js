import{c as y,k as Te,e as F,g as Pe}from"./@babel-D91nw8a6.js";import{c as it}from"./classnames-ixCMRz17.js";import{B as ut}from"./rc-input-Bmy_hX1Q.js";import{e as ke,z as st,K as w}from"./rc-util-BGVI6VDl.js";import{r as o,a as x}from"./react-jFU0esu9.js";import{T as ct}from"./rc-textarea-DDW_S4__.js";import"./rc-resize-observer-CUhI3ncJ.js";import{T as ft}from"./@rc-component-CHdcDd_A.js";import{E as vt,M as Ne}from"./rc-menu-Cq6fhH-B.js";function dt(){var e=o.useState({id:0,callback:null}),t=y(e,2),u=t[0],s=t[1],l=o.useCallback(function(c){s(function(a){var f=a.id;return{id:f+1,callback:c}})},[]);return o.useEffect(function(){var c;(c=u.callback)===null||c===void 0||c.call(u)},[u]),l}var Oe=o.createContext(null);function mt(e){var t=o.useContext(Oe),u=t.notFoundContent,s=t.activeIndex,l=t.setActiveIndex,c=t.selectOption,a=t.onFocus,f=t.onBlur,m=e.prefixCls,v=e.options,E=v[s]||{};return o.createElement(vt,{prefixCls:"".concat(m,"-menu"),activeKey:E.key,onSelect:function(b){var h=b.key,p=v.find(function(C){var I=C.key;return I===h});c(p)},onFocus:a,onBlur:f},v.map(function(g,b){var h=g.key,p=g.disabled,C=g.className,I=g.style,M=g.label;return o.createElement(Ne,{key:h,disabled:p,className:C,style:I,onMouseEnter:function(){l(b)}},M)}),!v.length&&o.createElement(Ne,{disabled:!0},u))}var pt={bottomRight:{points:["tl","br"],offset:[0,4],overflow:{adjustX:1,adjustY:1}},bottomLeft:{points:["tr","bl"],offset:[0,4],overflow:{adjustX:1,adjustY:1}},topRight:{points:["bl","tr"],offset:[0,-4],overflow:{adjustX:1,adjustY:1}},topLeft:{points:["br","tl"],offset:[0,-4],overflow:{adjustX:1,adjustY:1}}},gt=function(t){var u=t.prefixCls,s=t.options,l=t.children,c=t.visible,a=t.transitionName,f=t.getPopupContainer,m=t.dropdownClassName,v=t.direction,E=t.placement,g="".concat(u,"-dropdown"),b=o.createElement(mt,{prefixCls:g,options:s}),h=o.useMemo(function(){var p;return v==="rtl"?p=E==="top"?"topLeft":"bottomLeft":p=E==="top"?"topRight":"bottomRight",p},[v,E]);return o.createElement(ft,{prefixCls:g,popupVisible:c,popup:b,popupPlacement:h,popupTransitionName:a,builtinPlacements:pt,getPopupContainer:f,popupClassName:m},l)},xt=function(){return null};function ht(e){var t=e.selectionStart;return e.value.slice(0,t)}function Ct(e,t){return t.reduce(function(u,s){var l=e.lastIndexOf(s);return l>u.location?{location:l,prefix:s}:u},{location:-1,prefix:""})}function Re(e){return(e||"").toLowerCase()}function St(e,t,u){var s=e[0];if(!s||s===u)return e;for(var l=e,c=t.length,a=0;a<c;a+=1)if(Re(l[a])!==Re(t[a])){l=l.slice(a);break}else a===c-1&&(l=l.slice(c));return l}function wt(e,t){var u=t.measureLocation,s=t.prefix,l=t.targetText,c=t.selectionStart,a=t.split,f=e.slice(0,u);f[f.length-a.length]===a&&(f=f.slice(0,f.length-a.length)),f&&(f="".concat(f).concat(a));var m=St(e.slice(c),l.slice(c-u-s.length),a);m.slice(0,a.length)===a&&(m=m.slice(a.length));var v="".concat(f).concat(s).concat(l).concat(a);return{text:"".concat(v).concat(m),selectionLocation:v.length}}function yt(e,t){e.setSelectionRange(t,t),e.blur(),e.focus()}function Et(e,t){return!t||e.indexOf(t)===-1}function bt(e,t){var u=t.value,s=u===void 0?"":u,l=e.toLowerCase();return s.toLowerCase().indexOf(l)!==-1}var _t=["prefixCls","className","style","prefix","split","notFoundContent","value","defaultValue","children","options","open","allowClear","silent","validateSearch","filterOption","onChange","onKeyDown","onKeyUp","onPressEnter","onSearch","onSelect","onFocus","onBlur","transitionName","placement","direction","getPopupContainer","dropdownClassName","rows","visible"],It=["suffix","prefixCls","defaultValue","value","allowClear","onChange","classNames","className","disabled","onClear"],Mt=o.forwardRef(function(e,t){var u=e.prefixCls,s=e.className,l=e.style,c=e.prefix,a=c===void 0?"@":c,f=e.split,m=f===void 0?" ":f,v=e.notFoundContent,E=v===void 0?"Not Found":v,g=e.value,b=e.defaultValue,h=e.children,p=e.options,C=e.open;e.allowClear;var I=e.silent,M=e.validateSearch,D=M===void 0?Et:M,V=e.filterOption,T=V===void 0?bt:V,L=e.onChange,_=e.onKeyDown,S=e.onKeyUp,re=e.onPressEnter,ae=e.onSearch,H=e.onSelect,oe=e.onFocus,G=e.onBlur,$e=e.transitionName,Fe=e.placement,Le=e.direction,Ae=e.getPopupContainer,Ke=e.dropdownClassName,le=e.rows,Be=le===void 0?1:le;e.visible;var De=Te(e,_t),j=o.useMemo(function(){return Array.isArray(a)?a:[a]},[a]),ie=o.useRef(null),A=o.useRef(null),q=o.useRef(null),J=function(){var n;return(n=A.current)===null||n===void 0||(n=n.resizableTextArea)===null||n===void 0?void 0:n.textArea};x.useImperativeHandle(t,function(){var i;return{focus:function(){var r;return(r=A.current)===null||r===void 0?void 0:r.focus()},blur:function(){var r;return(r=A.current)===null||r===void 0?void 0:r.blur()},textarea:(i=A.current)===null||i===void 0||(i=i.resizableTextArea)===null||i===void 0?void 0:i.textArea,nativeElement:ie.current}});var Ve=o.useState(!1),ue=y(Ve,2),U=ue[0],se=ue[1],je=o.useState(""),ce=y(je,2),fe=ce[0],ve=ce[1],Ue=o.useState(""),de=y(Ue,2),me=de[0],We=de[1],Xe=o.useState(0),pe=y(Xe,2),ge=pe[0],xe=pe[1],Ye=o.useState(0),he=y(Ye,2),Q=he[0],Z=he[1],ze=o.useState(!1),Ce=y(ze,2),He=Ce[0],Se=Ce[1],Ge=ke("",{defaultValue:b,value:g}),we=y(Ge,2),P=we[0],qe=we[1];o.useEffect(function(){U&&q.current&&(q.current.scrollTop=J().scrollTop)},[U]);var Je=x.useMemo(function(){if(C)for(var i=0;i<j.length;i+=1){var n=j[i],r=P.lastIndexOf(n);if(r>=0)return[!0,"",n,r]}return[U,fe,me,ge]},[C,U,j,P,fe,me,ge]),W=y(Je,4),k=W[0],ee=W[1],X=W[2],te=W[3],ne=x.useCallback(function(i){var n;return p&&p.length>0?n=p.map(function(r){var d;return F(F({},r),{},{key:(d=r==null?void 0:r.key)!==null&&d!==void 0?d:r.value})}):n=st(h).map(function(r){var d=r.props,N=r.key;return F(F({},d),{},{label:d.children,key:N||d.value})}),n.filter(function(r){return T===!1?!0:T(i,r)})},[h,p,T]),Y=x.useMemo(function(){return ne(ee)},[ne,ee]),Qe=dt(),Ze=function(n,r,d){se(!0),ve(n),We(r),xe(d),Z(0)},O=function(n){se(!1),xe(0),ve(""),Qe(n)},ye=function(n){qe(n),L==null||L(n)},et=function(n){var r=n.target.value;ye(r)},Ee=function(n){var r,d=n.value,N=d===void 0?"":d,R=wt(P,{measureLocation:te,targetText:N,prefix:X,selectionStart:(r=J())===null||r===void 0?void 0:r.selectionStart,split:m}),$=R.text,K=R.selectionLocation;ye($),O(function(){yt(J(),K)}),H==null||H(n,X)},tt=function(n){var r=n.which;if(_==null||_(n),!!k){if(r===w.UP||r===w.DOWN){var d=Y.length,N=r===w.UP?-1:1,R=(Q+N+d)%d;Z(R),n.preventDefault()}else if(r===w.ESC)O();else if(r===w.ENTER){if(n.preventDefault(),I)return;if(!Y.length){O();return}var $=Y[Q];Ee($)}}},nt=function(n){var r=n.key,d=n.which,N=n.target,R=ht(N),$=Ct(R,j),K=$.location,z=$.prefix;if(S==null||S(n),[w.ESC,w.UP,w.DOWN,w.ENTER].indexOf(d)===-1)if(K!==-1){var B=R.slice(K+z.length),Me=D(B,m),lt=!!ne(B).length;Me?(r===z||r==="Shift"||d===w.ALT||r==="AltGraph"||k||B!==ee&&lt)&&Ze(B,z,K):k&&O(),ae&&Me&&ae(B,z)}else k&&O()},rt=function(n){!k&&re&&re(n)},be=o.useRef(),_e=function(n){window.clearTimeout(be.current),!He&&n&&oe&&oe(n),Se(!0)},Ie=function(n){be.current=window.setTimeout(function(){Se(!1),O(),G==null||G(n)},0)},at=function(){_e()},ot=function(){Ie()};return x.createElement("div",{className:it(u,s),style:l,ref:ie},x.createElement(ct,Pe({ref:A,value:P},De,{rows:Be,onChange:et,onKeyDown:tt,onKeyUp:nt,onPressEnter:rt,onFocus:_e,onBlur:Ie})),k&&x.createElement("div",{ref:q,className:"".concat(u,"-measure")},P.slice(0,te),x.createElement(Oe.Provider,{value:{notFoundContent:E,activeIndex:Q,setActiveIndex:Z,selectOption:Ee,onFocus:at,onBlur:ot}},x.createElement(gt,{prefixCls:u,transitionName:$e,placement:Fe,direction:Le,options:Y,visible:!0,getPopupContainer:Ae,dropdownClassName:Ke},x.createElement("span",null,X))),P.slice(te+X.length)))}),Nt=o.forwardRef(function(e,t){var u=e.suffix,s=e.prefixCls,l=s===void 0?"rc-mentions":s,c=e.defaultValue,a=e.value,f=e.allowClear,m=e.onChange,v=e.classNames,E=e.className,g=e.disabled,b=e.onClear,h=Te(e,It),p=o.useRef(null),C=o.useRef(null);o.useImperativeHandle(t,function(){var _,S;return F(F({},C.current),{},{nativeElement:((_=p.current)===null||_===void 0?void 0:_.nativeElement)||((S=C.current)===null||S===void 0?void 0:S.nativeElement)})});var I=ke("",{defaultValue:c,value:a}),M=y(I,2),D=M[0],V=M[1],T=function(S){V(S),m==null||m(S)},L=function(){T("")};return x.createElement(ut,{suffix:u,prefixCls:l,value:D,allowClear:f,handleReset:L,className:E,classNames:v,disabled:g,ref:p,onClear:b},x.createElement(Mt,Pe({className:v==null?void 0:v.mentions,prefixCls:l,ref:C,onChange:T,disabled:g},h)))});Nt.Option=xt;export{Nt as M};
